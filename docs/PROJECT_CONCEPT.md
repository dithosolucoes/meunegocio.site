# Documento Conceitual: Projeto MeuNegocio.site

## 1. Visão Geral do Projeto

O **MeuNegocio.site** é uma plataforma de Software como Serviço (SaaS) que permite a usuários finais (pequenos negócios, freelancers, etc.) criar e publicar um site simples de uma página. 

O principal diferencial é a simplicidade e a oferta de um subdomínio personalizado e fácil de lembrar (ex: `nomedaloja.meunegocio.site`). O objetivo é fornecer uma presença online profissional com o mínimo de esforço técnico por parte do usuário.

## 2. Arquitetura Técnica

A plataforma é construída sobre uma arquitetura multi-tenant, onde uma única instância da aplicação serve a múltiplos clientes (tenants).

### 2.1. Stack Tecnológica

- **Framework Frontend:** [Next.js](https://nextjs.org/) (com App Router)
- **Estilização:** [TailwindCSS](https://tailwindcss.com/)
- **Backend e Banco de Dados:** [Supabase](https://supabase.com/)
- **Autenticação:** [Supabase Auth](https://supabase.com/docs/guides/auth)
- **Deployment:** [Vercel](https://vercel.com/)
- **Ambiente de Desenvolvimento:** [Nixpacks](https://nixpacks.com/)

### 2.2. Lógica de Multi-Tenancy (O Core da Aplicação)

A mágica do multi-tenancy é gerenciada pela combinação do `middleware.ts` da Vercel/Next.js e a estrutura de arquivos do Next.js.

1.  **Requisição:** Um visitante acessa `exemplo.meunegocio.site`.
2.  **DNS:** O DNS (configurado na Vercel) aponta todos os subdomínios `*.meunegocio.site` para a mesma aplicação Next.js.
3.  **Middleware:** O arquivo `middleware.ts` na raiz do projeto intercepta TODAS as requisições.
4.  **Extração do Subdomínio:** O middleware extrai o subdomínio (`exemplo`) do cabeçalho `host` da requisição.
5.  **Reescrita de URL:** O middleware então reescreve a URL internamente, sem que o usuário perceba. A requisição para `exemplo.meunegocio.site` é transformada em uma requisição para `/app/_sites/exemplo`.
6.  **Renderização Dinâmica:** O Next.js renderiza a página localizada em `app/_sites/[site]/page.tsx`, passando `exemplo` como o parâmetro `site`.
7.  **Busca de Dados:** O componente da página (`page.tsx`) usa o parâmetro recebido (`exemplo`) para consultar o banco de dados Supabase na tabela `sites` e buscar os dados específicos daquele tenant.

## 3. Estrutura de Arquivos Relevante

```
/
|-- app/
|   |-- _sites/[site]/         # Pasta para o template dinâmico do site do cliente
|   |   |-- page.tsx           # Componente que renderiza o site do cliente, busca dados no BD
|   |-- dashboard/             # (Planejado) Pasta para o painel de controle do usuário logado
|   |-- layout.tsx             # Layout raiz da aplicação
|   |-- page.tsx               # A LANDING PAGE principal do projeto (meunegocio.site)
|-- docs/
|   |-- PROJECT_CONCEPT.md     # Este arquivo.
|-- lib/
|   |-- supabase.ts            # Cliente Supabase para interagir com o banco de dados.
|-- middleware.ts              # O arquivo que gerencia o roteamento de subdomínios.
|-- nixpacks.toml              # Configuração do ambiente de desenvolvimento.
```

## 4. Modelo de Dados (Supabase)

O banco de dados contém uma tabela principal para gerenciar os sites.

### Tabela `sites`

```sql
CREATE TABLE sites (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id), -- (Planejado) Chave estrangeira para o dono do site
  created_at TIMESTAMPTZ DEFAULT NOW(),
  name TEXT,                             -- Nome do negócio, ex: "Pizzaria do João"
  description TEXT,                      -- Descrição do negócio
  subdomain TEXT NOT NULL UNIQUE,        -- O identificador único, ex: "pizzariadojoao"
  custom_domain TEXT UNIQUE,             -- (Planejado) Para domínios como "www.pizzariadojoao.com"
);
```

### Segurança (Row Level Security - RLS)

- **Leitura Pública:** Uma política de RLS permite que qualquer pessoa (`SELECT`) leia os dados da tabela `sites`. Isso é necessário para que os sites dos clientes sejam publicamente visíveis.
- **Acesso Restrito (Planejado):** Políticas futuras irão garantir que apenas o usuário autenticado e dono do site (`user_id`) possa fazer alterações (`INSERT`, `UPDATE`, `DELETE`) em seu próprio registro.

## 5. Roadmap do Projeto

O desenvolvimento seguirá uma abordagem faseada.

- **Fase 0: Fundação (Concluída)**
  - Setup do projeto Next.js.
  - Implementação da lógica de multi-tenancy com middleware.
  - Conexão inicial com Supabase.
  - Deploy inicial na Vercel.
  - Criação da Landing Page (`app/page.tsx`).

- **Fase 1: Autenticação de Usuários**
  - Integrar Supabase Auth para Cadastro, Login e Logout.
  - Criar páginas `/login` e `/signup`.
  - Associar sites a usuários com a coluna `user_id`.

- **Fase 2: Dashboard e Gerenciamento**
  - Criar a rota protegida `/dashboard`.
  - Construir o formulário que permite ao usuário criar/editar seu site (nome, descrição, subdomínio).
  - Implementar as políticas de segurança (RLS) para edição.

- **Fase 3: Monetização**
  - Integrar Stripe para planos de assinatura.
  - Criar página de preços.
  - Gerenciar status de assinatura no Supabase.

- **Fase 4: Recursos Avançados**
  - Suporte a domínios personalizados.
  - Múltiplos templates de site.
  - Construtor de páginas mais avançado.
